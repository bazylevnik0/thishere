<html>
<head>
</head>
<body>
</body>
</body>

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>Babylon Template</title>

        <style>
            html, body {
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #renderCanvas {
                width: 100%;
                height: 100%;
                touch-action: none;
            }
            #player {
              position: absolute;
              z-index: 1;
          }
           #rendercanvas {
              position: absolute;
              z-index: 2;
          }
	#upload {
    position: absolute;
    height: 500px;
    top: 500px;
    z-index: 8;
}

	#div_drop {
	position: absolute;
	z-index: 3;
}
	#drop {
	position: absolute;
	z-index: 3;
}


#photo {
    width: 100px;
    height: 100px;
    position: absolute;
    bottom: 150px;
    left: 45%;
}
#return {
    width: 100px;
    height: 100px;
    position: absolute;
    top: 150px;
    left: 45%;
}

#level{
    position: absolute;
    left: 40%;
    top: 50%;
    transform: rotate(270deg);
    width: 100%;
}
#size{
    position: absolute;
    right: 40%;
    top: 50%;
    transform: rotate(270deg);
    width: 100%;
}
        </style>

        <script src="https://cdn.babylonjs.com/babylon.js"></script>
        <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
	 <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
	<script src="https://code.jquery.com/pep/0.4.3/pep.js"></script>
    </head>

   <body>
<video id="player" controls width="100%" height="100%" autoplay="true"></video>
<script>
													//FADEIN FADEOUT animation for UI 
  var player = document.getElementById('player');

  var handleSuccess = function(stream) {
    player.srcObject = stream;
  };

  navigator.mediaDevices.getUserMedia({ audio: false, video: true }).then(handleSuccess)
</script>

    <canvas id="renderCanvas" touch-action="none"></canvas> <!-- touch-action="none" for best results from PEP -->

    <script>

	
        const canvas = document.getElementById("renderCanvas"); // Get the canvas element
        const engine = new BABYLON.Engine(canvas, true); // Generate the BABYLON 3D engine

        // Add your code here matching the playground format

	var scene = new BABYLON.Scene(engine);
       scene.clearColor = new BABYLON.Color4(0, 0, 0, 0);
	var camera = new BABYLON.ArcRotateCamera("camera", -Math.PI / 2, Math.PI / 2.5, 3, new BABYLON.Vector3(0, 0, 0), scene);
	camera.attachControl(canvas, true);

	var light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);

	// Register a render loop to repeatedly render the scene
        engine.runRenderLoop(function () {
            	    // Game/Render loop
   	    scene.render();
	
        });

        // Watch for browser/canvas resize events
        window.addEventListener("resize", function () {
                engine.resize();
        });


	//upload
	function loadFiles () {
		console.log("loadFiles")
	
	//important! we must check real size and correct this 
		//maybe we must correct link obj to mtl
		//if obj not zero element we need find obj!
		BABYLON.SceneLoader.ImportMeshAsync("", files[0].webkitRelativePath , files[0].name).then((result) => {
    		console.log(result.meshes)
		for (let i = 0; i < result.meshes.length; i++) {
		result.meshes[i].scaling.x = 0.25;
    		result.meshes[i].scaling.y = 0.25;
    		result.meshes[i].scaling.z = 0.25;
		}
    		var myMesh1 = scene.getMeshByName("myMesh_1");
		console.log(result)
	})
	
	}
    </script>

<form id="upload" method="post" enctype="multipart/form-data">
 <div>
   <label for="files">Choose file to upload</label>
   <input type="file" id="files" name="files" multiple onchange="readFiles()" webkitrelativepath="true">
 </div>
 <div>
   <button>Submit</button>
 </div>
</form>


<div id="div_drop" ondrop="drop(event)" ondragover="allowDrop(event)"></div>

<img id="drop" src="img_logo.gif" draggable="true" ondragstart="drag(event)" width="336" height="69">

<script>
	 upload_form = document.getElementById('upload');
   
//drag and drop
function allowDrop(ev) {
  ev.preventDefault();
}

function drag(ev) {
  ev.dataTransfer.setData("text", ev.target.id);
}

function drop(ev) {
  ev.preventDefault();
  var data = ev.dataTransfer.getData("text");
  ev.target.appendChild(document.getElementById(data));
}

//input 
var files , reader
function readFiles() {
    console.log("readFiles")
	// this png 
	// this obj
		   //?

    files = document.getElementById('files').files;
    console.log(files)

    let temp;
    for(let i = 0; i < files.length; i++) {
   	console.log(files[i].name , files[i].webkitRelativePath)
    }
  
    editMode();
    loadFiles();
}
</script>
<button id="return" onclick="returnClick()">return</button>
<script>
	let return_button = document.getElementById('return')
	function returnClick() {
  		document.getElementById('files').value = "";
		scene.meshes = scene.meshes.constructor();
		uploadMode();
	}
</script>
<button id="photo" onclick="photoClick()">photo</button>
<script>
	let photo_button = document.getElementById('photo')
	function photoClick() {
		console.log("photoClick"); 
	}
</script>
<div class="slidecontainer">
  <input type="range" min="1" max="100" value="50" class="slider" id="level" oninput="levelChange()">
</div>
<script>
level = document.getElementById('level');

function levelChange() {
	console.log("levelChange")
}
</script>
<div class="slidecontainer">
  <input type="range" min="1" max="100" value="50" class="slider" id="size" oninput="levelChange()">
</div>

<script>

size = document.getElementById('size');
function sizeChange() {
	console.log("sizeChange")
}
</script>
   </body>
<script>
	function editMode() {
		upload_form.style.zIndex=0
		return_button.style.zIndex=8
		photo_button.style.zIndex=8
		level.style.zIndex=8
		size.style.zIndex=8
		
		    BABYLON.VirtualJoystick.Canvas.style.zIndex = "3";

		console.log("editMode")
	}

	function uploadMode() {
		upload_form.style.zIndex=8
		return_button.style.zIndex=0
		photo_button.style.zIndex=0
	     level.style.zIndex=0
		size.style.zIndex=0
		
		   
		    BABYLON.VirtualJoystick.Canvas.style.zIndex = "0";

		console.log("uploadMode")

	}

//sticks
var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");

var leftJoystick = new BABYLON.VirtualJoystick(false);
    var rightJoystick = new BABYLON.VirtualJoystick(true);
    BABYLON.VirtualJoystick.Canvas.style.zIndex = "0";
  var movespeed = 5
  
 scene.onBeforeRenderObservable.add(()=>{
        if(leftJoystick.pressed){
            moveX = leftJoystick.deltaPosition.x * (engine.getDeltaTime()/1000) * movespeed;
            moveZ = leftJoystick.deltaPosition.y * (engine.getDeltaTime()/1000) * movespeed;
          for (let i = 0; i < scene.meshes.length; i++) {
	    scene.meshes[i].rotation.x+=moveX
            scene.meshes[i].rotation.z+=moveZ
	 }            
        }
        if(rightJoystick.pressed){
            moveXX = rightJoystick.deltaPosition.x * (engine.getDeltaTime()/1000) * movespeed;
            moveZZ = rightJoystick.deltaPosition.y * (engine.getDeltaTime()/1000) * movespeed;
         for (let j = 0; j < scene.meshes.length; j++) {
	   scene.meshes[j].position.x+=moveXX
           scene.meshes[j].position.z+=moveZZ
         }
	}
    })

</script>
</html>
